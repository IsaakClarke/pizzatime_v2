# pizzatime_v2

В репозитории два файла:

4pgagent_task - это основной и полноценный скрипт, который создаст схему/таблицы, зальет функцию и процедуры в DB
Все, что требуется сделать - дать pgagent права на процедуру и выставить период обновления в минуту (call pizzatime.update_order_statuses())

После выполнения запроса, используйте:
-- SELECT pizzatime.getpizza(); - меню
-- SELECT pizzatime.getpizza(pizza => 'Пепперони', name => 'Любое'); - пример заказа
-- CALL pizzatime.update_order_statuses(); - обновление статуса (нужен для pgagent)
-- CALL pizzatime.show_board(); - табло заказов

----------------------------

pizzatime_demo - это демо, со встроенным в show_board() фрагментом из update_order_statuses()
Отличия - после выполнения не нужен pgagent. Вызывайте show_board() и статусы будут обновляться

После выполнения запроса, используйте:
-- SELECT pizzatime.getpizza(); - меню
-- SELECT pizzatime.getpizza(pizza => 'Пепперони', name => 'Любое'); - пример заказа
-- CALL pizzatime.show_board(); - табло заказов

В функции есть защита от sqli, валидация наименования пиццы

ООП в стиле SQL: таблицы как сущности, функции как поведение

В чем смысл?

Сущности = Таблицы
pizzas — это объект "Пицца" со свойствами name, price
orders — это объект "Заказ", в нем client_name, pizza_name, status, created_at
Вместо классов таблицы, вместо полей — столбцы

----------------------------

Методы = Функции и процедуры
То есть у каждого "класса" (таблицы) есть своё "поведение" (функции), и они чётко разграничены.

getpizza(...) — как метод PizzaOrder.place()
→ делает заказ или выводит меню

update_order_statuses() — как метод Order.updateStatus()

show_board() — как метод Display.show()

----------------------------

Инкапсуляция
Клиент не трогает напрямую таблицу orders. Он работает только через getpizza() — как через публичный метод.

----------------------------

Абстракция и ответственность
pizzas — хранит только меню. Всё.

orders — только про заказы, с чёткой структурой

Функции и процедуры не размазаны по логике — каждая делает одно

----------------------------

Переиспользуемость

Как вариант:
добавить оплату
новые статусы
расширить до нескольких пицц в заказе

----------------------------
